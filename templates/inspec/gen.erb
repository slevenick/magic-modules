title 'Test GCP <%= name -%> resource.'


control '<%= name -%>-1.0' do
  impact 1.0
  title '<%= name -%> resource test'

  plural_identifiers = []
<% 
individual_url = format_url(object.self_link_url[1])
params = individual_url.scan(/({{)(\w+)(}})/).map { |arr| arr[1] } 


%>
<% if params.include?('zone') %>
  zone_names = google_compute_zones(project: 'graphite-test-outside').zone_names
  zone_names.each do |zone_name|
    plural_identifiers.push({project: 'graphite-test-outside', zone: zone_name})
  end
<% else %>
  plural_identifiers.push({project: 'graphite-test-outside'})
<% end %>
  i = 0
  plural_identifiers.each do |plural_identifier|
    plural = <%= name.pluralize -%>(plural_identifier)
    identifiers = plural.identifiers
    
    identifiers.each do |identifier|
      <%= name -%>(identifier).dump('<%= p -%>', i)
      i += 1
    end
  end
end