def un_parse
  {
<% object.all_user_properties.each do |prop| -%>
    '<%= prop.out_name -%>' => ->(x, path) { x.nil? ? [] : <%= un_parse_code(prop, false) -%> },
<% end # object.all_user_properties.each -%>
  }
end

def dump(path, i, ignored_fields)

  name = '<%= object.name %>'

  
  arr = un_parse.map do |k, v|
    next if ignored_fields.include?(k)
    v.call(method(k.to_sym).call, k)
  end
  my_map = {
    name: name,
    arr: arr,
    type: '<%= resource_name(object, product_ns) -%>',
    identifiers: @params,
    number: i
  }
  File.open("#{path}/#{name}_#{i}.rb", 'w') do |file|
    file.write(ERB.new(File.read(ENV["TEMPLATE_PATH"])).result_with_hash(my_map))
  end


end